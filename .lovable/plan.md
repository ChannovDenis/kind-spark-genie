
# План: Патч доработки Добросервис 2.0

## Обзор изменений

Документ патча содержит **5 блоков** доработок, затрагивающих 4 модуля платформы. Общий объем: **10 новых страниц**, **3 переработанных страницы**, **1 удаление**, обновление навигации.

| Блок | Модуль | Новые страницы | Переделка | Удаление |
|------|--------|----------------|-----------|----------|
| 1 | Контент-студия | 3 | 2 | 1 |
| 2 | Супер-админ | 4 | 1 | — |
| 3 | Эксперт | 1 | 1 (rename) | — |
| 4 | Quality | 1 | — | — |
| 5 | Sidebar | — | 1 | — |

---

## Блок 5: Обновление навигации (Sidebar) — ПЕРВЫЙ

Начинаем с sidebar, чтобы навигация была готова для всех новых страниц.

### Изменения в AppSidebar.tsx

**Группа "Контент-студия":**
- Видео → /studio (оставить)
- Тренды → /studio/trends (оставить)
- Генератор → УДАЛИТЬ
- **+ Сценарии** → /studio/scenarios (иконка FileText)
- **+ Лента** → /studio/feed (иконка Newspaper)

**Группа "Эксперт":**
- Расписание → переименовать в **"Календарь"** (маршрут /expert/calendar)
- **+ Доходы** → /expert/earnings (иконка Wallet)

**Группа "Супер-админ":**
- Тенанты → /super (оставить)
- Тарифы → /super/pricing (оставить)
- **+ Кампании** → /super/campaigns (иконка Megaphone)
- **+ Эксперты** → /super/experts (иконка UserCog)
- **+ Аналитика** → /super/analytics (иконка BarChart3)
- Настройки → /super/settings (оставить)
- Конструктор → УДАЛИТЬ из меню (функционал интегрируется в тенанты)

**Группа "Quality Center":**
- **+ Лог шёпота** → /quality/whisper-log (иконка Eye)

---

## Блок 1: Контент-студия — VideoGen пайплайн

### 1.1 Переделка /studio (Dashboard)

Полностью заменить контент `StudioDashboard.tsx`:

**Метрики (4 карточки):**
- "Опубликовано сегодня" → 4, иконка Play, тренд +2
- "В генерации" → 2, иконка Loader
- "Черновики" → 7, иконка FileEdit
- "Просмотры (неделя)" → 12 340, иконка Eye, тренд +18%

**Секция "Быстрые действия" (3 карточки):**
- "Из тренда" → /studio/trends
- "По шаблону" → /studio/scenarios
- "VSL с аватаром" → /studio/scenarios?type=vsl

**Секция "Последние ролики" (grid 3 колонки, 6 карточек):**
- Превью с иконками платформ (app/YT/VK/TG)
- Статус-бейджи: Черновик/Генерация/Готов/Опубликован
- Одна карточка с анимированным прогресс-баром 60%

### 1.2 Новая страница /studio/scenarios

**Компоненты:**
- Top bar: кнопка "+ Новый сценарий", фильтры (категория/статус/тип), поиск
- Таблица: Превью | Название | Тип | Категория | Тенант | Сцен | Статус | Дата | Действия
- 8 строк mock-данных
- DropdownMenu: Редактировать / Дублировать / Удалить
- Клик по строке → /studio/scenarios/:id

### 1.3 Новая страница /studio/scenarios/:id (Редактор сценария)

**Layout: grid-cols-[1fr_340px]**

**LEFT — Сцены:**
- Input заголовок + StatusBadge
- Вертикальный список сцен (5 штук):
  - Каждая сцена: glass-card с border-left 3px
  - Поля: "Текст на экране", "Промпт для видео", "Озвучка"
  - Бейджи: "Хук" / "CTA"
  - Ghost-кнопки: Удалить / Дублировать / Вверх / Вниз
- Кнопка "+ Добавить сцену"
- AI-блок: Input тема + "Сгенерировать"

**RIGHT — Настройки:**
- Секция "Основное": категория, тенант, тип, хронометраж
- Секция "Озвучка": голос, скорость (slider)
- Секция "Визуал": музыка, титры (toggle), стиль титров
- Секция "CTA в ленте": промпт для чата
- Кнопки: "Сгенерировать видео" (→ Dialog), "Сохранить черновик"

**Dialogs:**
1. Dialog генерации (800px): прогресс-бар, список сцен со статусами, стоимость
2. Dialog превью (900px): плеер, таймлайн с 4 дорожками, кнопки скачивания
3. Dialog публикации (640px): метаданные, чекбоксы платформ, расписание

### 1.4 Новая страница /studio/feed

- Top bar: фильтры (тенант/категория/статус/поиск)
- Таблица: Превью | Заголовок | Категория | Тенант | Дата | Просмотры | Клики AI | Каналы | Статус | Действия
- 8 строк mock-данных
- Иконки платформ 16px
- Действия: Статистика / Снять / Переопубликовать

### 1.5 Удаление /studio/generator

- Удалить `src/pages/studio/Generator.tsx`
- Удалить маршрут из `App.tsx`
- Оставить `/studio/video/:id` (используется для аналитики)

---

## Блок 2: Супер-админ — достройка

### 2.1 Новая страница /super/tenants/:id

**Layout: Tabs (4 таба)**

**Таб "Основное":**
- Inputs: название, домен, контакт, email
- Selects: тариф, статус
- Дата подключения

**Таб "Сервисы":**
- Таблица с toggles: сервис | включён | лимит | использовано

**Таб "Брендинг":**
- Color picker, input название в приложении
- Dropzone для логотипа
- Превью мобильного экрана

**Таб "Лимиты":**
- Read-only биллинг тенанта

### 2.2 Переделка /super/pricing

**Layout: grid-cols-[280px_1fr]**

**LEFT — Список тарифов:**
- Вертикальный список: Starter, Business, Enterprise, ГПБ Кастом
- Статусы: active (зелёная точка) / draft (серая)
- Кнопка "+ Новый тариф"

**RIGHT — Редактор тарифа:**
- Inputs: название, цена
- Textarea: описание
- Секция "Сервисы и лимиты": таблица с toggles
- Секция "Мини-приложения": checkboxes
- Секция "Условия": select перерасход, input макс. пользователей

### 2.3 Новая страница /super/campaigns

- Top bar: кнопка "+ Новая кампания", фильтры
- Grid 2 колонки карточек:
  - Заголовок, описание, бейджи (канал + статус)
  - Метрики: отправлено / открыто / CTR
  - Действия: Редактировать / Дублировать / Остановить
- 5 mock-кампаний

### 2.4 Новая страница /super/campaigns/new

**Stepper (4 шага):**
1. "Сегмент": название + rule builder
2. "Сообщение": канал, заголовок, текст, CTA, превью
3. "Расписание": radio (сейчас / по расписанию / триггер)
4. "Запуск": саммари + кнопки

### 2.5 Новая страница /super/experts

- Таблица: Фото | Имя | Специализация | Рейтинг | Сессий | Тенанты | Статус | Действия
- 6 строк mock-данных
- Аватары через dicebear API
- Фильтры: специализация / статус / тенант

### 2.6 Новая страница /super/analytics

**Метрики (4 карточки):**
- DAU: 4 230, тренд +5%
- WAU: 18 700, тренд +3%
- MAU: 52 400, тренд +8%
- MRR: 2 450 000 ₽, тренд +12%

**Графики (2 колонки):**
- LEFT: "Активность по тенантам" — BarChart stacked (7 дней)
- RIGHT: "Распределение по сервисам" — PieChart/DonutChart

**BOTTOM:**
- "MRR по месяцам" — AreaChart (сен 2025 — фев 2026)

---

## Блок 3: Эксперт — доработки

### 3.1 Переименование /expert/schedule → /expert/calendar

- Переименовать маршрут в App.tsx
- Обновить sidebar
- Расширить функционал существующего `Schedule.tsx`:
  - Добавить Dialog "Добавить время" с полями: дни, время, длительность, перерыв
  - Добавить карточку настроек справа: toggle "Принимать записи", select "Макс. в день", toggle "Синхр. Google"

### 3.2 Новая страница /expert/earnings

**Метрики (3 карточки):**
- "За февраль" → 47 500 ₽
- "Консультаций" → 14
- "Средняя" → 3 393 ₽

**Таблица:**
- Колонки: Дата | Клиент | Сервис | Длительность | Сумма | Статус
- 5 строк mock-данных
- Низ: "Итого за период" + кнопка "Выгрузить отчёт"

---

## Блок 4: Quality — доработка

### 4.1 Новая страница /quality/whisper-log

**Layout: Вертикальный таймлайн-лог**

- Шрифт: monospace (JetBrains Mono или system-ui monospace)
- Каждая запись:
  - Timestamp: "08.02.2026 14:23:01" muted
  - Тип: "Supervisor → Agent" / "Agent decision"
  - Текст сообщения
  - Confidence с цветом (>0.7 зелёный / 0.4-0.7 жёлтый / <0.4 красный)
  - Результат: "Принято" / "Отклонено"
- 10 mock-записей
- Фильтры: период / результат / confidence

---

## Структура файлов

### Новые файлы (12)

| Путь | Описание |
|------|----------|
| `src/pages/studio/Scenarios.tsx` | Библиотека сценариев |
| `src/pages/studio/ScenarioEditor.tsx` | Редактор сценария |
| `src/pages/studio/Feed.tsx` | Управление лентой |
| `src/pages/super/TenantDetail.tsx` | Настройка тенанта |
| `src/pages/super/Campaigns.tsx` | CRM-кампании |
| `src/pages/super/CampaignEditor.tsx` | Конструктор кампании |
| `src/pages/super/Experts.tsx` | Реестр экспертов |
| `src/pages/super/Analytics.tsx` | Глобальная аналитика |
| `src/pages/expert/Earnings.tsx` | Доходы эксперта |
| `src/pages/quality/WhisperLog.tsx` | Лог шёпота |
| `src/data/studioScenariosData.ts` | Mock-данные сценариев |
| `src/data/superData.ts` | Mock-данные супер-админа |

### Модифицируемые файлы (6)

| Путь | Изменения |
|------|-----------|
| `src/components/layout/AppSidebar.tsx` | Новые пункты меню |
| `src/App.tsx` | Новые маршруты, удаление /studio/generator |
| `src/pages/studio/Dashboard.tsx` | Полная переделка |
| `src/pages/super/Pricing.tsx` | Полная переделка |
| `src/pages/expert/Schedule.tsx` | Расширение + rename маршрута |
| `src/data/mockData.ts` | Новые mock-данные |

### Удаляемые файлы (1)

| Путь | Причина |
|------|---------|
| `src/pages/studio/Generator.tsx` | Заменяется на /studio/scenarios/:id |

---

## Порядок реализации

1. **Sidebar** — обновить навигацию
2. **Mock-данные** — создать studioScenariosData.ts и superData.ts
3. **App.tsx** — добавить маршруты, удалить старые
4. **Блок 1** — Контент-студия (Dashboard → Scenarios → ScenarioEditor → Feed)
5. **Блок 2** — Супер-админ (Pricing → TenantDetail → Campaigns → CampaignEditor → Experts → Analytics)
6. **Блок 3** — Эксперт (Calendar rename + Earnings)
7. **Блок 4** — Quality (WhisperLog)
8. **Удаление** — Generator.tsx

---

## Технические детали

### Форматирование (по спецификации)
- Даты: `format(date, 'd MMM yyyy', { locale: ru })` → "8 фев 2026"
- Числа: `toLocaleString('ru-RU')` → "1 847"
- Валюта: `${formatNumber(value)} ₽` → "1 500 ₽"
- Себестоимость: `$0.04`

### Компоненты
- Все страницы используют `PageHeader`, `MetricCard`, `StatusBadge`
- Таблицы: shadcn Table
- Графики: Recharts (BarChart, PieChart, AreaChart)
- Иконки: Lucide React
- Стиль: glass-card, тёмная тема

### Новые иконки для импорта
- Newspaper, Wallet, Megaphone, UserCog (Lucide)

---

## Результат

После реализации:
- **Контент-студия**: полный VideoGen пайплайн с редактором сценариев
- **Супер-админ**: управление тенантами, тарифами, кампаниями, экспертами, аналитика
- **Эксперт**: календарь с настройками + отслеживание доходов
- **Quality**: мониторинг AI supervisor через лог шёпота
